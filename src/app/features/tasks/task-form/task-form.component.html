<div class="task-form">
  <h3>{{ (isEditing$ | async) ? "Modifier la tâche" : "Nouvelle tâche" }}</h3>
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="title">Titre</label>
      <input
        type="text"
        id="title"
        formControlName="title"
        [class.is-invalid]="
          form.get('title')?.invalid && form.get('title')?.touched
        "
      />
      <div
        class="invalid-feedback"
        *ngIf="form.get('title')?.invalid && form.get('title')?.touched"
      >
        Le titre est requis
      </div>
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea
        id="description"
        formControlName="description"
        rows="3"
        [class.is-invalid]="
          form.get('description')?.invalid && form.get('description')?.touched
        "
      ></textarea>
      <div
        class="invalid-feedback"
        *ngIf="
          form.get('description')?.invalid && form.get('description')?.touched
        "
      >
        La description est requise
      </div>
    </div>

    <div class="form-group">
      <label for="dueDate">Date d'échéance</label>
      <input
        type="date"
        id="dueDate"
        formControlName="dueDate"
        [class.is-invalid]="
          form.get('dueDate')?.invalid && form.get('dueDate')?.touched
        "
      />
      <div
        class="invalid-feedback"
        *ngIf="form.get('dueDate')?.invalid && form.get('dueDate')?.touched"
      >
        La date d'échéance est requise
      </div>
    </div>

    <div class="form-group">
      <label class="checkbox-label">
        <input type="checkbox" formControlName="status" />
        Tâche terminée
      </label>
    </div>

    <div class="form-group">
      <label for="tags">Tags</label>
      <div class="tags-input-container">
        <input
          type="text"
          id="tags"
          [formControl]="currentTag"
          placeholder="Ajouter un tag..."
          (keyup.enter)="addTag()"
        />
        <button type="button" class="btn btn-add-tag" (click)="addTag()">
          Ajouter
        </button>
      </div>
      <div class="tags-container" *ngIf="form.get('tags')?.value?.length">
        <button
          type="button"
          class="tag"
          *ngFor="let tag of form.get('tags')?.value"
          (click)="removeTag(tag)"
        >
          {{ tag }}
          <span class="tag-remove-icon">×</span>
        </button>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        {{ (isEditing$ | async) ? "Mettre à jour" : "Créer" }}
      </button>
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        Annuler
      </button>
    </div>
  </form>
</div>
