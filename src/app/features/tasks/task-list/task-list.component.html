<div class="task-list">
  <div class="filters-container">
    <div class="search-container">
      <input
        type="text"
        [formControl]="searchControl"
        placeholder="Rechercher une tâche..."
        class="search-input"
      />
    </div>
    <div class="status-filter">
      <select [formControl]="statusFilter" class="status-select">
        <option value="all">All Tasks</option>
        <option value="completed">Completed</option>
        <option value="pending">In Progress</option>
      </select>
    </div>
  </div>

  <ng-container *ngIf="filteredTasks$ | async as tasks">
    <ng-container
      *ngIf="
        (tasks | filterByStatus : statusFilter.value || 'all')?.length;
        else noTasks
      "
    >
      <div
        *ngFor="
          let task of tasks | filterByStatus : statusFilter.value || 'all';
          trackBy: trackByTaskId
        "
        class="task-item"
      >
        <div class="task-content" (click)="toggleTaskExpansion(task.id)">
          <div class="task-header">
            <h4>{{ task.title }}</h4>
            <div class="task-meta">
              <span
                class="comments-count"
                *ngIf="taskCommentsCount.get(task.id)"
              >
                {{ taskCommentsCount.get(task.id) }} commentaire(s)
              </span>
              <span class="due-date">
                Date d'échéance: {{ task.dueDate | date : "dd/MM/yyyy" }}
              </span>
            </div>
          </div>
          <p>{{ task.description }}</p>
          <p>{{ task.status ? "Completed" : "In progress" }}</p>
          <div class="task-tags" *ngIf="task.tags?.length">
            <span class="task-tag" *ngFor="let tag of task.tags">{{
              tag
            }}</span>
          </div>
        </div>
        <div class="task-actions">
          <button class="btn btn-edit" (click)="onEdit(task)">Modifier</button>
          <button class="btn btn-delete" (click)="onDelete(task)">
            Supprimer
          </button>
        </div>
        <div class="comments-section" *ngIf="isTaskExpanded(task.id)">
          <app-comment-form
            [taskId]="task.id"
            (onCommentAdded)="updateCommentsCount(task.id)"
          ></app-comment-form>
          <app-comment-list [taskId]="task.id"></app-comment-list>
        </div>
      </div>
    </ng-container>
  </ng-container>

  <ng-template #noTasks>
    <div class="no-tasks-message">
      <p>Aucune tâche ne correspond à vos critères de recherche.</p>
      <p
        *ngIf="searchControl.value || statusFilter.value !== 'all'"
        class="suggestion"
      >
        Essayez de modifier vos filtres ou votre recherche.
      </p>
    </div>
  </ng-template>
</div>
